<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PracticeLoop - Music Practice Tool</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Heap Analytics -->
    <script type="text/javascript">
      window.heapReadyCb=window.heapReadyCb||[],window.heap=window.heap||[],heap.load=function(e,t){window.heap.envId=e,window.heap.clientConfig=t=t||{},window.heap.clientConfig.shouldFetchServerConfig=!1;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.us.heap-api.com/config/"+e+"/heap_config.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(a,r);var n=["init","startTracking","stopTracking","track","resetIdentity","identify","getSessionId","getUserId","getIdentity","addUserProperties","addEventProperties","removeEventProperty","clearEventProperties","addAccountProperties","addAdapter","addTransformer","addTransformerFn","onReady","addPageviewProperties","removePageviewProperty","clearPageviewProperties","trackPageview"],i=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);window.heapReadyCb.push({name:e,fn:function(){heap[e]&&heap[e].apply(heap,t)}})}};for(var p=0;p<n.length;p++)heap[n[p]]=i(n[p])};
      heap.load("3079155083");
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>üéµ PracticeLoop</h1>
                <div class="header-actions">
                    <span id="accountBadge" class="account-badge free">Free (3 videos)</span>
                    <button id="shareReferralBtn" class="btn-share-referral" onclick="app.showReferralModal()">
                        Share & Earn
                    </button>
                    <a href="https://pay.tide.co/products/music-pract-dojo6MnC" target="_blank"
                       id="buyLicenseLink"
                       onclick="app.trackEvent('upgrade_link_clicked', {source: 'header'})"
                       class="buy-license-link">
                        Buy a Licence
                    </a>
                    <a href="#" id="licenseKeyLink" onclick="app.showLicenseKeyModal(); return false;" class="license-link">
                        Enter License Key
                    </a>
                </div>
            </div>
        </header>

        <!-- YouTube Search Section (shown only if API key available) -->
        <section class="search-section" id="searchSection" style="display: none;">
            <div class="input-group">
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search YouTube videos..."
                    aria-label="Search YouTube"
                >
                <button id="searchBtn" class="btn btn-secondary">Search</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </section>

        <!-- Add Video Section -->
        <section class="add-video-section">
            <div class="input-group">
                <input
                    type="text"
                    id="videoUrlInput"
                    placeholder="Enter YouTube URL..."
                    aria-label="YouTube URL"
                >
                <button id="addVideoBtn" class="btn btn-primary">Add Video</button>
            </div>
        </section>

        <!-- Video Library -->
        <section class="video-library">
            <h2>Video Library</h2>
            <div id="videoList" class="video-list">
                <!-- Videos will be populated here -->
            </div>
        </section>

        <!-- Video Player Section -->
        <section class="player-section" id="playerSection" style="display: none;">
            <div class="video-container">
                <div id="player"></div>
            </div>

            <div class="video-info">
                <h3 id="currentVideoTitle">Select a video to start practicing</h3>
            </div>

            <!-- Playback Controls -->
            <div class="controls">
                <!-- Main Controls (Play/Pause, Skip to Start, Seek) -->
                <div class="control-group main-controls-row">
                    <button id="skipToStartBtn" class="btn btn-skip" aria-label="Skip to start">
                        <span class="icon">‚èÆ</span>
                        <span class="label">Start</span>
                    </button>
                    <button id="seekBackBtn" class="btn btn-seek" aria-label="Rewind 5 seconds">
                        <span class="icon">‚è™</span>
                        <span class="label">-5s</span>
                    </button>
                    <button id="playPauseBtn" class="btn btn-play-pause" aria-label="Play/Pause">
                        <span class="icon">‚ñ∂</span>
                    </button>
                    <button id="seekForwardBtn" class="btn btn-seek" aria-label="Forward 5 seconds">
                        <span class="icon">‚è©</span>
                        <span class="label">+5s</span>
                    </button>
                </div>

                <!-- Speed Control -->
                <div class="control-group speed-control">
                    <label for="speedSlider">Speed: <span id="speedDisplay">1.0x</span></label>
                    <input
                        type="range"
                        id="speedSlider"
                        min="0.25"
                        max="1"
                        step="0.05"
                        value="1"
                        aria-label="Playback speed"
                    >
                    <div class="speed-presets">
                        <button class="btn btn-preset" data-speed="0.5">0.5x</button>
                        <button class="btn btn-preset" data-speed="0.75">0.75x</button>
                        <button class="btn btn-preset" data-speed="1.0">1.0x</button>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="control-group timeline">
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    <div class="timeline-container">
                        <div class="timeline-bar">
                            <div id="progressBar" class="progress-bar"></div>
                            <div id="loopOverlay" class="loop-overlay" style="display: none;"></div>
                        </div>
                        <input
                            type="range"
                            id="timelineSlider"
                            min="0"
                            max="100"
                            value="0"
                            aria-label="Video timeline"
                        >
                    </div>
                </div>

                <!-- Loop Controls -->
                <div class="control-group loop-controls">
                    <h4>Loop Section</h4>
                    <p class="loop-instructions">
                        Play your video, click "Set Start" at the beginning of the section you want to practice,
                        then click "Set End" where you want the loop to finish. Click "Enable Loop" to repeat automatically.
                    </p>
                    <div class="loop-buttons">
                        <button id="setLoopStartBtn" class="btn btn-loop">
                            Set Start
                            <span id="loopStartDisplay" class="loop-time">--:--</span>
                        </button>
                        <button id="setLoopEndBtn" class="btn btn-loop">
                            Set End
                            <span id="loopEndDisplay" class="loop-time">--:--</span>
                        </button>
                        <button id="toggleLoopBtn" class="btn btn-loop" disabled>
                            Enable Loop
                        </button>
                        <button id="clearLoopBtn" class="btn btn-loop-clear">
                            Clear Loop
                        </button>
                    </div>
                    <p class="keyboard-hints">Keyboard: Space = play/pause, [ = loop start, ] = loop end, L = toggle loop</p>
                </div>

                <!-- Save Loop Section -->
                <div class="control-group save-loop-section" id="saveLoopSection" style="display:none;">
                    <h4>Save This Loop</h4>
                    <div class="save-loop-row">
                        <input type="text" id="loopNameInput" placeholder="Name this loop (e.g. 'Bridge - tricky bit')" class="loop-name-input">
                        <button id="saveLoopBtn" class="btn btn-save-loop" onclick="app.doSaveLoop()">Save Loop</button>
                    </div>
                    <div id="savedLoopsContainer" class="saved-loops-container">
                        <p class="no-loops-hint">No saved loops yet.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer with Version -->
        <footer class="app-footer">
            <p class="version">PracticeLoop v0.2.0</p>
        </footer>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></canvas>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="confetti.js"></script>
    <script src="app.js"></script>
</body>
</html>
